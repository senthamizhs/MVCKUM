@{
    Layout = null;
    string fileversion = System.Configuration.ConfigurationManager.AppSettings["UpdateVersion"] != null ? System.Configuration.ConfigurationManager.AppSettings["UpdateVersion"].ToString() : "";
    string ProductType = System.Configuration.ConfigurationManager.AppSettings["Producttype"].ToString();
    string PrintTicketFormat = System.Configuration.ConfigurationManager.AppSettings["PrintTicketFormat"].ToString();
    string Agenttype = Session["agenttype"] != null ? Session["agenttype"].ToString() : "";
    string servicechargelbl = ProductType == "RIYA" ? "Management Fee" : "Service Charge";
    string strTheme = System.Configuration.ConfigurationManager.AppSettings["apptheme"].ToString();
    string strUserMailID = ViewBag.UserMailID != null ? ViewBag.UserMailID : "";
    string strIsAgentLogin = Session["IsAgentLogin"] != null && Session["IsAgentLogin"].ToString() != "" ? Session["IsAgentLogin"].ToString() : "N";
    string adt_dis = string.Empty;
    string chd_dis = string.Empty;
    string inf_dis = string.Empty;
    string wordcopy = string.Empty;
    string strImageURL = System.Configuration.ConfigurationManager.AppSettings["LogoUrl"] != null ? System.Configuration.ConfigurationManager.AppSettings["LogoUrl"].ToString() : "";
    string strLoaderURL = strImageURL + "/" + ProductType + "/" + "loader.gif?" + fileversion;
    if (ViewBag.Allowadultinput == "1")
    {
        adt_dis = "servicepaxdisplay_block";
    }
    if (ViewBag.Allowchildinput == "1")
    {
        chd_dis = "servicepaxdisplay_block";
    }
    if (ViewBag.allowinfadult == "1")
    {
        inf_dis = "servicepaxdisplay_block";
    }
    wordcopy = PrintTicketFormat != "RIYA" ? "display:none" : "";
    string strdispClslogo = string.Empty;
    string strdispClsbreakup = string.Empty;
    string strdispClsSF = string.Empty;
    string strClsChecked = string.Empty;
    if (PrintTicketFormat == "RIYA")
    {
        strdispClslogo = "display:block;";
        strdispClsbreakup = "display:block;";
        strdispClsSF = "display:block;";
        strClsChecked = "checked";
    }
    else if (PrintTicketFormat == "ROUNDTRIP")
    {
        strdispClslogo = "display:block;";
        strdispClsbreakup = "display:none;";
        strdispClsSF = "display:none;";
    }
    else
    {
        strdispClslogo = "display:none;";
        strdispClsbreakup = "display:none;";
        strdispClsSF = "display:none;";
    }
    string strClsChkLogo = string.Empty;
    if (ViewBag.hdnSpnr_U.Split('|').Length > 2)
    {
        strClsChkLogo = ViewBag.hdnSpnr_U.Split('|')[2].ToString().ToUpper() == "YES" ? "checked" : "";
    }
    }

<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="@Url.Content("~/Images/" + ProductType + "/favicon.ico")" />
    <link href="~/Content/CSS/Component.css?@fileversion" rel="stylesheet" />
    <link href="~/Content/CSS/Colors.css" rel="stylesheet" />
    <link href="~/Content/CSS/bootstrap.css" rel="stylesheet" />
    <link href="~/Content/CSS/ionicons.css" rel="stylesheet" />
    <link href="~/Content/CSS/font-awesome.css" rel="stylesheet" />
    @if (ProductType == "JOD")
    {
        <link href="~/Content/CSS/jod/jod_flight.css?@fileversion" rel="stylesheet" />
    }
    else if (ProductType == "RIYA")
    {
        <link href="/Content/CSS/Theme4/style.css?@fileversion" rel="stylesheet" />
    }
    else if (ProductType == "RBOA")
    {
        <link href="~/Content/CSS/Riya_BOA/riya_boa.css" rel="stylesheet" />
    }
    else
    {
        <link href="/Content/CSS/@strTheme/style.css?@fileversion" rel="stylesheet" />
    }
    <script src="~/js/CommonJS/jquery-1.11.1.js" type="text/javascript"></script>
    <script src="~/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="~/js/jquery.blockUI.js"></script>
    <style>
        span.spnclosepopup {position: absolute;top: -18px;right: -7px;background: #fff;border: 1px solid #eee;border-radius: 50%;font-size: 18px;
                            padding: 0px 5px;cursor: pointer;}
        .servicepaxdisplay_block {display: block !important;}
        .paymentpopups {text-align: center;height: 40px;border: 1px solid #1faeff;color: #ffffff;font-weight: bold;font-size: 15px;
                        background: #1faeff url(UIImages/ui-bg_gloss-wave_35_f6a828_500x100.png) 50% 50% repeat-x;padding: 10px 0px 0px 0px;}
        .prnt-header {text-align: center;color: #fff;font-size: 15px;}
        .prnt-row-header {padding: 5px;background: #1faeff;}
        .prnt-row-header label {font-size:15px;color:#fff;padding:4px 10px;}
        .rb-div {width: 100%;min-height: 20px!important;}
        #modal-pg_formContainer .modal-dialog.modal-md {width: 30%;top: 0 !important;}
        .prnt-rgt-icon ul {float: right;margin-bottom: 0px;}
        .prnt-rgt-icon ul li {list-style: none;display: inline-block;float: left;margin-right: 20px;}
        .someClass {height: 330px;overflow-y: scroll;}
        ul#Submenu li label{margin-right: 10px;font-size: 12px;}
        @@media (max-width: 767px) {
            .prnt-row-header label {text-align: center;width: 100%;}
            .prnt-rgt-icon ul {padding-inline-start:0;width: 100%;}
            .prnt-rgt-icon ul li {margin-right: 0;width: 20%;}
            ._Mpaddd {padding:0 !important;}
            #modal-pg_formContainer .modal-dialog.modal-md {width: 100%;margin: 10px 0;}
        }

        .SendEmail {background-color: transparent;background-image: url("@Url.Content("~/Images/MessagesNew.png")");background-repeat: no-repeat;
        padding: 2px;color: #FFF;border: 0;cursor: pointer;width: 34px;height: 35px;float: right;margin-top: 0px;}
        .pdfprintcopy{background-color: transparent;background-image: url("@Url.Content("~/Images/PDFExport.png")");background-repeat: no-repeat;
        padding: 2px;color: #FFF;border: 0;cursor: pointer;width: 34px;height: 35px;float: right;margin-top: 0px;        }
        .wordprintcopy{background-color: transparent;background-image: url("@Url.Content("~/Images/DOCS.png")");background-repeat: no-repeat;
        padding: 2px;color: #FFF;border: 0;cursor: pointer;width: 34px;height: 35px;float: right;margin-top: 0px;         }
        .ContactDetails {width: 100%;background-color: #fff;border: 1px solid #CCC;margin-left: 0px;}
        table.ContactDetails tr th {border: 1px solid #ccc;background: #27a5f5;padding: 5px;text-align: center;}
        ul#Submenu {list-style: none;padding: 0px;margin: 5px 0px;}
        .submenu {margin: 5px;}
        ul li.var_navNew-B {padding: 8px;text-align: left;background: #99cc33;margin-bottom: 3px;}
        ul li.var_navNew-G {padding: 8px;text-align: left;background: #27a5f5;margin-bottom: 3px;}
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col-lg-12 _Mpadd pad-0-res">
                <div class="row prnt-row-header row0">
                    <div class="col-lg-6">
                        <label id="print">Print Ticket</label>
                    </div>
                    <div class="col-lg-6">
                        <div class="prnt-rgt-icon">
                            <ul>
                                <li><img src="@Url.Content("~/Images/PrinterIcon.png")" alt="Print" title="Print" style="float: right;cursor: pointer;" onclick="Print_sheet()" /></li>
                                <li><input id="SendEmail" class="SendEmail" type="button" alt="Send Email" title="Send Email" /></li>
                                <li style="display: block;"><input id="btnEmail" class="pdfconvert pdfprintcopy" type="button" onclick="PrintTicketPDF();" alt="PDF" title="PDF" /></li>
                                <li><img src="@Url.Content("~/Images/HTML.png")" style="float: right;cursor: pointer;" onclick="savehtml()" alt="Save HTML" title="Save HTML" /></li>
                                <li style="@wordcopy">
                                    @using (Html.BeginForm("wordTktconverter", "AfterBooking", FormMethod.Post, new { enctype = "multipart/form-data" }))
                                    {
                                        <input type="submit" id="btnWord" class="wordconvert wordprintcopy" value="" alt="Word Convert" title="Word Convert" />
                                    }
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12 _Mpaddd">
                <div id="PrinTicket1">
                    @Html.Raw(ViewBag.printdetails)
                </div>
            </div>
        </div>
    </div>

    <input type="hidden" id="hdnsingle" />
    <input type="hidden" id="hdnSpnr" />
    <input type="hidden" id="Wfare" />
    <input type="hidden" id="SPNR" />
    <input type="hidden" id="Hdnsinglereferforpdf" />
    <input type="hidden" id="Allowadultinput" />
    <input type="hidden" id="Allowchildinput" />
    <input type="hidden" id="allowinfadult" />
    <input type="hidden" id="hdnadultfare_" />
    <input type="hidden" id="hdnchildfare_" />
    <input type="hidden" id="hdninffare_" />
    <input type="hidden" id="hdnadultmarkup_" />
    <input type="hidden" id="hdnchildmarkup_" />
    <input type="hidden" id="hdninfmarkup_" />
    <input type="hidden" id="hdnPax" />


    <div class="modal fade" id="modal-Sendmailoption" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" style="top: 20%;">
            <div class="modal-content">
                <div class="modal-body clsPopupBody" style="padding: 10px;">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="header paymentpopups">
                                <span class="sprite_bookingco"></span><span class="_M001">Send Email</span>
                            </div>
                            <span class="spnclosepopup" data-dismiss="modal"><i class="fa fa-close"></i></span>
                        </div>
                    </div>
                    <div class="main">
                        <div class="row" style="margin: 15px;">
                            <div class="col-lg-12">
                                <div class="row">
                                    <div class="col-lg-12" style="margin-bottom: 15px;">
                                        <p class="validateTips"><span style="color: red;">*</span>All fields are required.</p>
                                    </div>
                                </div>
                                @if (PrintTicketFormat != "RIYA")
                                {
                                    <div class="row">
                                        <div class="col-lg-4 col-lg-offset-4 col-xs-6" style="margin-bottom: 20px;">
                                            <div class="rb-div">
                                                <input type="radio" class="rb" id="htmlclick" name="nameradio" checked>
                                                <label for="htmlclick" class="rblbl">Html</label>
                                                <div class="bullet">
                                                    <div class="line zero"></div>
                                                    <div class="line one"></div>
                                                    <div class="line two"></div>
                                                    <div class="line three"></div>
                                                    <div class="line four"></div>
                                                    <div class="line five"></div>
                                                    <div class="line six"></div>
                                                    <div class="line seven"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-xs-6" style="margin-bottom: 20px;">
                                            <div class="rb-div">
                                                <input type="radio" class="rb" id="pdfclick" name="nameradio">
                                                <label for="pdfclick" class="rblbl">PDF</label>
                                                <div class="bullet">
                                                    <div class="line zero"></div>
                                                    <div class="line one"></div>
                                                    <div class="line two"></div>
                                                    <div class="line three"></div>
                                                    <div class="line four"></div>
                                                    <div class="line five"></div>
                                                    <div class="line six"></div>
                                                    <div class="line seven"></div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                }
                                <div class="row">
                                    <div class="col-lg-4 col-xs-12 mg-btm-20-res">
                                        <span>Mail Send To</span>
                                    </div>
                                    <div class="col-lg-8 col-xs-12" style="margin-bottom: 20px;">
                                        <div class="dv-anim input-effect m-0 m-sm-t20">
                                            <input id="txtToEmail" maxlength="100" class="txt-anim" type="text" />
                                            <label>Your Email Id</label>
                                            <span class="focus-border">
                                                <i></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-4 col-xs-12 mg-btm-20-res">
                                        <span>Mail Send Cc</span>
                                    </div>
                                    <div class="col-lg-8 col-xs-12" style="margin-bottom: 20px;">
                                        <div class="dv-anim input-effect m-0 m-sm-t20">
                                            <input id="txtCCEmail" maxlength="100" class="txt-anim" type="text" />
                                            <label>Enter Cc Email Id</label>
                                            <span class="focus-border">
                                                <i></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-4 col-xs-12 mg-btm-20-res">
                                        <span>Subject</span>
                                    </div>
                                    <div class="col-lg-8 col-xs-12" style="margin-bottom: 20px;">
                                        <div class="dv-anim input-effect m-0 m-sm-t20">
                                            <input id="txtSubject" maxlength="50" class="txt-anim" type="text" />
                                            <label>Your Electronic Ticket Information</label>
                                            <span class="focus-border">
                                                <i></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-4 col-xs-12 col-lg-offset-4" style="margin-bottom: 20px;">
                                        <div id="pouplitag" style="display: none; text-align: center;">
                                            <img src="@Url.Content("~/Images/animated-overlay.gif")">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <hr class="hidden-xs" />
                            <div class="row mg-btm-0-res" style="margin-bottom: 15px;">
                                <div class="col-md-offset-3 col-md-3 col-xs-6 mg-btm-0-res" style="margin-bottom: 15px;">
                                    <input type="button" class="btn btn-md btn-primary width100per" id="btnpaymentOKMAil" value="Send" />
                                </div>
                                <div class="col-md-3 col-xs-6 mg-btm-0-res" style="margin-bottom: 15px;">
                                    <input type="button" value="Cancel" data-dismiss="modal" class="btn btn-md btn-danger width100per" id="btnclosepops" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-servicecharge" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" style="top: 20%;">
            <div class="modal-content">
                <div class="modal-body clsPopupBody" style="padding: 10px;">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="header paymentpopups">
                                Service Charge
                            </div>
                        </div>
                    </div>
                    <div class="main">
                        <div class="row" style="margin: 15px;">
                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <div class="cntr col-xs-12 col-md-4 col-sm-4" style="padding: 0px;@strdispClslogo">
                                    <input style="display: none;" type="checkbox" id="Chk_logo_popup" class="cb" @strClsChkLogo><label class="cbx" for="Chk_logo_popup"></label><label class="lbl" style="margin-left: 5px;" for="Chk_logo_popup">With Logo</label>
                                </div>
                                <div class="cntr col-xs-12 col-md-4 col-sm-4" style="padding: 0px;@strdispClsbreakup">
                                    <input style="display: none;" type="checkbox" id="Chk_breakup_popup" class="cb" @strClsChecked><label class="cbx" for="Chk_breakup_popup"></label><label style="margin-left: 5px;" class="lbl" for="Chk_breakup_popup">With BreakUp</label>
                                </div>
                                <div class="cntr col-xs-12 col-md-4 col-sm-4" style="padding: 0px;@strdispClsSF">
                                    <input style="display: none;" type="checkbox" id="Chk_sf_popup" class="cb" @strClsChecked><label class="cbx" for="Chk_sf_popup"></label><label style="margin-left: 5px;" class="lbl" for="Chk_sf_popup">With SF</label>
                                </div>
                            </div>
                            <div class="col-lg-4 col-lg-offset-4 col-xs-12" style="text-align: left; margin-bottom: 15px;">
                                <p class="validateTips" style="text-align: center; display: none;">Additional Amounts</p>
                            </div>
                            <div class="col-lg-12">
                                <div class="row" id="adtRow">
                                    <div class="col-lg-3 col-xs-3" style="text-align: center;">
                                        <p>Pax&nbsp;Type</p>
                                    </div>
                                    <div class="col-lg-3 col-xs-3">
                                        <span>Pax&nbsp;Count</span>
                                    </div>
                                    <div class="col-lg-3 col-xs-3">
                                        <span>@servicechargelbl</span>
                                    </div>
                                    @if (ProductType == "RIYA" && Agenttype == "RI")
                                    {
                                        <div class="col-lg-3 col-xs-3" style="display: none">
                                            <span>Markup</span>
                                        </div>
                                    }
                                </div>
                                <div class="row @adt_dis" id="adtRow" style="display: none;">
                                    @if (ViewBag.grpbooking == true)
                                    {
                                        <div class="col-lg-3 col-xs-3" style="text-align: center;">
                                            <p id="TAdult">Group</p>
                                        </div>
                                        <div class="col-lg-3 col-xs-3">
                                            <span id="TAdultcnt">@Html.Raw(ViewBag.Groupcount)</span>
                                        </div>
                                        <div class="col-lg-3 col-xs-3">
                                            <input name="txtadult" type="text" id="txtadult" maxlength="10" style="width: 75%;" onkeypress="isNumericVal(event)" value="@ViewBag.Grp_amt" class="TxTextbox">
                                        </div>
                                        if (ProductType == "RIYA" && Agenttype == "RI")
                                        {
                                            <div class="col-lg-3 col-xs-3" style="display: none">
                                                <input name="txtadult_markup" type="text" id="txtadult_markup" maxlength="10" style="width: 75%; text-align: right;" onkeypress="isNumericVal(event)" value="0" class="TxTextbox">
                                            </div>
                                        }
                                    }
                                    else
                                    {
                                        <div class="col-lg-3 col-xs-3" style="text-align: center;">
                                            <p id="TAdult">Adult</p>
                                        </div>
                                        <div class="col-lg-3 col-xs-3">
                                            <span id="TAdultcnt">@Html.Raw(ViewBag.Txtadultcnt)</span>
                                        </div>
                                        <div class="col-lg-3 col-xs-3">
                                            <input name="txtadult" type="text" id="txtadult" maxlength="10" style="width: 75%;" onkeypress="isNumericVal(event)" value="@ViewBag.txtadult" class="TxTextbox">
                                        </div>
                                        if (ProductType == "RIYA" && Agenttype == "RI")
                                        {
                                            <div class="col-lg-3 col-xs-3" style="display: none">
                                                <input name="txtadult_markup" type="text" id="txtadult_markup" maxlength="10" style="width: 75%;text-align:right;" onkeypress="isNumericVal(event)" value="@ViewBag.txtadult_mkp" class="TxTextbox">
                                            </div>
                                        }
                                    }

                                </div>

                                <div class="row @chd_dis" id="chdRow" style="display: none;">

                                    <div class="col-lg-3 col-xs-3" style="text-align: center;">
                                        <p id="TChild">Child</p>
                                    </div>
                                    <div class="col-lg-3 col-xs-3">
                                        <span id="TChildcnt">@Html.Raw(@ViewBag.Txtchildcnt)</span>
                                    </div>
                                    <div class="col-lg-3 col-xs-3">
                                        <input name="txtChild" type="text" id="txtChild" maxlength="10" style="width: 75%;" onkeypress="isNumericVal(event)" value="@ViewBag.txtChild" class="TxTextbox">
                                    </div>
                                    @if (ProductType == "RIYA" && Agenttype == "RI")
                                    {
                                        <div class="col-lg-3 col-xs-3" style="display: none">
                                            <input name="txtchild_markup" type="text" id="txtchild_markup" maxlength="10" style="width: 75%;text-align:right;" onkeypress="isNumericVal(event)" value="@ViewBag.txtChild_mkp" class="TxTextbox">
                                        </div>
                                    }
                                </div>

                                <div class="row @inf_dis" id="infRow" style="display: none;">

                                    <div class="col-lg-3 col-xs-3" style="text-align: center;">
                                        <p id="TInfant">Infant</p>
                                    </div>
                                    <div class="col-lg-3 col-xs-3">
                                        <span id="Tinfantcnt">@Html.Raw(@ViewBag.Txtinfantcnt)</span>
                                    </div>
                                    <div class="col-lg-3 col-xs-3">
                                        <input name="txtinfant" type="text" id="txtinfant" maxlength="10" style="width: 75%;" onkeypress="isNumericVal(event)" value="@ViewBag.txtinfant" class="TxTextbox">
                                    </div>
                                    @if (ProductType == "RIYA" && Agenttype == "RI")
                                    {
                                        <div class="col-lg-3 col-xs-3" style="display: none">
                                            <input name="txtinfant_markup" type="text" id="txtinfant_markup" maxlength="10" style="width: 75%;text-align:right;" onkeypress="isNumericVal(event)" value="@ViewBag.txtinfant_mkp" class="TxTextbox">
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="row" style="margin-bottom: 15px;">
                            <div class="col-md-offset-3 col-md-3 col-xs-6">
                                <button value="Ok" class="btn btn-md btn-primary width100per" id="btnpaymentOK" onclick="updateservicecharge()" style="height: auto !important;">
                                    Submit
                                    <i id="iLoading" class="fa fa-spinner fa-spin" style="font-size: 25px; color: #292929; display: none; color: #fff; margin-top: -20px; margin-left: 80px;"></i>
                                </button>
                            </div>
                            <div class="col-md-3 col-xs-6">
                                <input type="button" value="Cancel" class="btn btn-md btn-danger width100per" onclick="printclicking();" id="btnclosepops_print" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modal-pg_formContainer" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-md" style="top: 20%;">
            <div class="modal-content">
                <div class="modal-body clsPopupBody" style="padding: 0px;">
                    <div class="main">
                        <div class="row" id="pg_form_InnerContainer" style="margin: 10px 0px 10px 5px;">
                            <div class="col-lg-12" id="singpasswflist">
                                @Html.Raw(ViewBag.singpasswflist)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>

        function PrintTicketPDF() {
            var SPnr = $("#hdnSpnr").val();
            SPnr = SPnr.split('|')[0];
            var param = { "strPNR": SPnr }
            $.blockUI({
                message: '<img alt="Please Wait..." src="@strLoaderURL" style="background-color:#fff; border-radius:8px; margin-top:12%;" id="FareRuleLodingImage" />',
                css: { padding: '5px' }
            });
            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: "@Url.Action("pdfTktconverter", "AfterBooking")",
                data: JSON.stringify(param),
                dataType: "json",
                success: function (data) {
                    $.unblockUI();
                    if (data.Status == "-1") {
                        window.top.location = sessionExb;
                        return false;
                    }

                    if (data.Status == "00" && data.Result != "") {
                        window.open(data.Result, "E-Ticket", 'left=100,top=100,width=800,height=600,menubar=no,location=no');
                        setTimeout(function () { PrintTicketPDF(); }, 5000);
                    }
                    else {

                        showerralert(data.Message, 3000);
                    }

                },
                error: function (result) {
                    $.unblockUI();
                    showerralert("Unable to convert PDF. Please try again later.", 3000);
                }
            });

        }

        function savehtml() {
            var strTicket = $("#PrinTicket1").html();
            var strFilename = "E-Ticket (" + $("#SPNR").val() + ").html";
            var element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(strTicket));
            element.setAttribute('download', strFilename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        if ('@ProductType' == "RIYA" && '@Agenttype' == "RI") {
            $("#txtadult").prop("disabled", true);
            $("#txtChild").prop("disabled", true);
            $("#txtinfant").prop("disabled", true);
            $("#txtadult_roundtrip").prop("disabled", true);
            $("#txtChild_roundtrip").prop("disabled", true);
            $("#txtinfant_roundtrip").prop("disabled", true);
        }
        else {
            $("#txtadult").prop("disabled", false);
            $("#txtChild").prop("disabled", false);
            $("#txtinfant").prop("disabled", false);
            $("#txtadult_roundtrip").prop("disabled", false);
            $("#txtChild_roundtrip").prop("disabled", false);
            $("#txtinfant_roundtrip").prop("disabled", false);
        }

        $("#Hdnsinglereferforpdf").val("@ViewBag.hdnsingle");

        var sessionExb = '@Url.Action("SessionExp", "Redirect")';
        $("#hdnsingle").val('@ViewBag.hdnsingle');
        var servicechargeupdate = '@Url.Action("InsertServiceAmount", "Booking")';
        var printopt = '@Url.Action("ticket_print", "AfterBooking")';
        $("#hdnadultfare_").val('@ViewBag.hdnadultfare_');
        $("#hdnchildfare_").val('@ViewBag.hdnchildfare_');
        $("#hdninffare_").val('@ViewBag.hdninffare_');

        $("#hdnadultmark_").val('@ViewBag.txtadult_mkp');
        $("#hdnchildmark_").val('@ViewBag.txtChild_mkp');
        $("#hdninfmark_").val('@ViewBag.txtinfant_mkp');

        var Mailsendingurl = '@Url.Action("btnEmail_pdforhtml_Click", "AfterBooking")';

        $("#SPNR").val('@ViewBag.Without_farechack');

        $("#hdnSpnr").val('@ViewBag.hdnSpnr_U');
        tips = $(".validateTips"),
          txtToEmail = $("#txtToEmail"),
          txtSubject = $("#txtSubject"),
          allFields = $([]).add(txtToEmail).add(txtSubject).add(tips),

        $("#btnpaymentOKMAil").click(function () {

            var bValid = true;
            allFields.removeClass("ui-state-error");

            var filter = /^([\w-]+(?:\.[\w-]+)*)@@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
            if ($("#txtToEmail").val() != "" && !filter.test($("#txtToEmail").val())) {
                var TomailIDtxt = $("#txtToEmail").val().split(',');
                for (var i = 0; i < TomailIDtxt.length; i++) {
                    if (!filter.test(TomailIDtxt[i])) {
                        showerralert("Please Enter valid To Email ID", 3000);
                        $("#txtToEmail").focus();
                        bValid = false;
                        return false;
                    }
                }
            }
            if ($("#txtCCEmail").val() != "") {
                var CCmailID = $("#txtCCEmail").val().split(',');
                for (var i = 0; i < CCmailID.length; i++) {
                    if (!filter.test(CCmailID[i])) {
                        showerralert("Please Enter valid Cc Email ID", 3000);
                        $("#txtCCEmail").focus();
                        bValid = false;
                        return false;
                    }
                }
            }
            if (bValid) {
                $('#txtto').val(txtToEmail.val().trim())
                $('#txtsub').val(txtSubject.val().trim())
                $('#pouplitag').css("display", "block");
                var pdf = "NO";
                if ('@PrintTicketFormat' != "RIYA") {
                    if (document.getElementById("pdfclick").checked == true) {
                        pdf = "YES";
                    }
                    else if (document.getElementById("htmlclick").checked == true) {
                        pdf = "NO";
                    }
                }
                if ($("#Chk_logo_popup").is(":checked") == true)
                    var logo = "yes";
                else
                    logo = "no";

                if ($("#Chk_breakup_popup").is(":checked") == true)
                    var breakup = "yes";
                else
                    breakup = "no";

                if ($("#Chk_sf_popup").is(":checked") == true)
                    var sf = "yes";
                else
                    sf = "no";
                Pnr = document.getElementById('hdnSpnr').value + '|' + logo + '|' + breakup + '|' + sf;

                var subject = $("#txtSubject").val();
                var mailid = $("#txtToEmail").val() + "MAILCCSPLIT" + $("#txtCCEmail").val();
                $.ajax({
                    type: "POST", 		//GET or POST or PUT or DELETE verb
                    url: Mailsendingurl, 		// Location of the service
                    data: '{strSPNRNO: "' + Pnr + '" ,txtEmailID: "' + mailid + '",pdf: "' + pdf + '",strSingle: "' + document.getElementById('hdnsingle').value + '",Subject:"' + subject + '" ,strPaymentmode : "' + sessionStorage.getItem('paymentmode') + '",blntktmailflag : "' + false + '"}',
                    //async: false,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (json) {//On Successful service call

                        $("#modal-Sendmailoption").modal("hide");
                        var result = json.Result;
                        if (result[1] != "") {
                            alert(result[1]);
                            $('#pouplitag').css("display", "none");
                            $("#txtToEmail").val('@strUserMailID');
                            $("#txtToEmail").addClass("has-content");
                            $("#txtSubject").val("");
                        }
                        else {
                            alert(result[0]);
                            $('#pouplitag').css("display", "none");
                            $("#txtToEmail").val('@strUserMailID');
                            $("#txtToEmail").addClass("has-content");
                            $("#txtSubject").val("");
                        }
                    },
                    error: function (e) {//On Successful service call
                        $('#dialog-form').dialog("close");
                        if (e.status == "500") {
                            alert("An Internal Problem Occurred. Your Session will Expire.");
                            window.top.location = sessionExb;
                            return false;
                        }
                    }  // When Service call fails
                });
            }
        });

        function updateTips(t) {
            tips
              .text(t)
              .addClass("ui-state-highlight");
            setTimeout(function () {
                tips.removeClass("ui-state-highlight", 1500);
            }, 500);
        }

        function checkRegexp(o, regexp, n) {
            if (!(regexp.test(o.val().trim()))) {
                o.addClass("ui-state-error");
                updateTips(n);
                return false;
            } else {
                return true;
            }
        }

        function Print_sheet() {
            var contents = document.getElementById("PrinTicket1").innerHTML;
            var frame1 = document.createElement('iframe');
            frame1.name = "frame1";
            frame1.style.position = "absolute";
            frame1.style.top = "-1000000px";
            document.body.appendChild(frame1);
            var frameDoc = frame1.contentWindow ? frame1.contentWindow : frame1.contentDocument.document ? frame1.contentDocument.document : frame1.contentDocument;
            frameDoc.document.open();
            frameDoc.document.write(contents);
            frameDoc.document.close();
            setTimeout(function () {
                window.frames["frame1"].focus();
                window.frames["frame1"].print();
                document.body.removeChild(frame1);
            }, 500);
            return false;
        }

        $('#SendEmail').click(function () {
            $("#modal-Sendmailoption").modal({
                backdrop: 'static',
                keyboard: false
            });
            $("#txtToEmail").val('@strUserMailID');
            $("#txtToEmail").addClass("has-content");
        });

        $("#Wfare").val("@ViewBag.Wfare");
        var pagerigts = '@ViewBag.Page';
        if ($("#Wfare").val().toUpperCase() == "YES" && pagerigts != "B" && '@strIsAgentLogin' == 'Y') {
            servicepopupshow();
        }
        else {
            if ($("#hdnsingle").val() == "yes") {
                if ($("#hdnsingle").val() == "yes" && $("#singpasswflist").html() != null && $("#singpasswflist").html().trim() != "") {
                    $("#modal-pg_formContainer").modal({
                        backdrop: 'static',
                        keyboard: false
                    });
                }
                else {
                    printclicking();
                }
            }
            else {
                printclicking();
            }
        }

        function servicepopupshow() {
            $("#modal-servicecharge").modal({
                backdrop: 'static',
                keyboard: false
            });
        }

        function updateservicecharge() {
            var bValid = true;
            this.enabled = false;
            if ('@ProductType' != "RIYA" && '@Agenttype' != "RI" && document.getElementById("hdnadultfare_").value == document.getElementById("txtadult").value && document.getElementById("hdnchildfare_").value == document.getElementById("txtChild").value && document.getElementById("hdninffare_").value == document.getElementById("txtinfant").value) {
                $("#modal-servicecharge").modal("hide");
            }
            else if ('@ProductType' == "RIYA" && '@Agenttype' == "RI" && $("#hdnadultfare_").val() == $("#txtadult").val() && $("#hdnchildfare_").val() == $("#txtChild").val() && $("#hdninffare_").val() == $("#txtinfant").val() && $("#hdnadultmarkup_").val() == $("#txtadult_markup").val() && $("#hdnchildmarkup_").val() == $("#txtchild_markup").val() && $("#hdninfmarkup_").val() == $("#txtinfant_markup").val()) {
                $("#modal-servicecharge").modal("hide");
            }
            else {
                var Adultmarkup = 0;
                var Childmarkup = 0;
                var Infantmarkup = 0;
                $("#iLoading").css("display", "block");
                $.ajax({
                    type: "POST", 		//GET or POST or PUT or DELETE verb
                    url: servicechargeupdate, 		// Location of the service
                    data: '{AdultAmount: "' + $("#txtadult").val() + '" ,ChildAmount: "' + $("#txtChild").val() + '" ,InfantAmount: "' + $("#txtinfant").val() + '",SPNR: "' + $("#SPNR").val() + '",Adultmarkup:"' + Adultmarkup + '",Childmarkup:"' + Childmarkup + '",Infantmarkup:"' + Infantmarkup + '"}',//,CancelationStatus: "' + $("#hdnPax")[0].value + '" ,BlockTicket: "' + BlockTicket + '",PaymentMode: "' + $("#ddlPaymode").val() + '",TourCode: "' + $("#Tour_Code").val() + '"}',
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (json) {//On Successful service call
                        var result = json.Result
                        $("#iLoading").css("display", "none");
                        if (result[1] != "") {
                            bValid = result[1];
                            var service_amt = 0;
                            alert(result[1]);
                      
                        }
                        else {
                            bValid = result[1];
                            alert(result[0]);
                        }
                        $("#modal-servicecharge").modal("hide");
                    },
                    error: function (e) {//On Successful service call
                        LogDetails(e.responseText, e.status, "InsertServiceAmount");
                        if (e.status == "500") {
                            alert("Session has been Expired.");
                            window.top.location = sessionExb;
                            return false;
                        }
                        $("#modal-servicecharge").modal("hide");
                    }	// When Service call fails
                });
            }
            if ($("#hdnsingle").val() == "yes" && $("#singpasswflist").html() != null && $("#singpasswflist").html().trim() != "") {
                $("#modal-pg_formContainer").modal({
                    backdrop: 'static',
                    keyboard: false
                });
            }
            else {
                printclicking('SU');    
            }
        }


        function printclicking(flag) {
            var Pnr = "";
            if ($("#Chk_logo_popup").is(":checked") == true)
                var logo = "yes";
            else
                logo = "no";
            if ($("#Chk_breakup_popup").is(":checked") == true)
                var breakup = "yes";
            else
                breakup = "no";
            if ($("#Chk_sf_popup").is(":checked") == true)
                var sf = "yes";
            else
                sf = "no";
            Pnr = '@ViewBag.SPNR.Split('|')[0]' + '|' + '@ViewBag.SPNR.Split('|')[1]' + '|' + logo + '|' + breakup + '|' + sf;
            var hidden_paxcount = $("#hdnPax").val();
            var singleticketopt = '@ViewBag.hdnsingle';
            var requstDetails = { SPNRNO: Pnr, single: singleticketopt, paxrefno: hidden_paxcount };
            if (singleticketopt.toUpperCase() == "YES" || flag == "SU") {
                $.ajax({
                    type: "POST", 		//GET or POST or PUT or DELETE verb
                    url: printopt, 		// Location of the service
                    data: JSON.stringify(requstDetails),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (json) {
                        $("#PrinTicket1").html(json.Result);
                        $("#modal-servicecharge").modal("hide");
                    },
                    error: function (e) {
                        LogDetails(e.responseText, e.status, "InsertServiceAmount");
                        if (e.status == "500") {
                            alert("Session has been Expired.");
                            window.top.location = sessionExb;
                            return false;
                        }
                    }
                });
            }
            else {
                if ($("#hdnsingle").val() == "yes") {
                    if ($("#hdnsingle").val() == "yes" && $("#singpasswflist").html() != null && $("#singpasswflist").html().trim() != "") {
                        $("#modal-pg_formContainer").modal({
                            backdrop: 'static',
                            keyboard: false
                        });
                    }
                    else {
                        printclicking();
                    }
                }
                //else {
                //    $("#PrinTicket1").html(printtickets);
                //}
            }
        }

        function checkallpaxxno() {
            var par = $("#Submenu li");
            if (document.getElementById("checkedallpaxxref").checked == true) {
                for (var i = 0; i < par.length; i++) {
                    $("#" + (i + 1))[0].checked = true;
                }
            }
            else {
                for (var i = 0; i < par.length; i++) {
                    $("#" + (i + 1))[0].checked = false;
                }
            }
        }

        function Paxrefno() {
            var par = $("#Submenu li");
            var TotalPax = "";
            var count = 0;
            document.getElementById('hdnPax').value = "";
            for (var i = 0; i < par.length; i++) {
                if ($("#" + (i + 1))[0].checked == true) {
                    TotalPax += (i + 1) + ",";
                    count++;
                }
            }
            document.getElementById('hdnPax').value = TotalPax.trim(',') + "|"
            if (count == 0) {
                alert("Please select atleast one passenger");
                return false;
            }
            else {
                $("#modal-pg_formContainer").modal("hide");
                printclicking();
            }
        }

        $('.Singleprintlist').click(function () {
            var checkcount = 0;
            var par = $("#Submenu li");
            for (var i = 0; i < par.length; i++) {
                if ($("#" + (i + 1))[0].checked == false) {
                    document.getElementById("checkedallpaxxref").checked = false;
                }
                else {
                    checkcount++;
                }
            }
            if (checkcount == par.length) {
                document.getElementById("checkedallpaxxref").checked = true;
            }
        });

        $(window).load(function (e) {
            $(".input-effect input").focusout(function () {
                if ($(this).val().trim() != "") {
                    $(this).addClass("has-content");
                }
                else {
                    $(this).removeClass("has-content");
                }
            });
            $(".input-effect textarea").focusout(function () {
                if ($(this).val().trim() != "") {
                    $(this).addClass("has-content");
                }
                else {
                    $(this).removeClass("has-content");
                }
            });
        });

        function showerralert(msg, timeout) {
            try {
                $(".validateTips").html(msg).addClass("ui-state-highlight");
                setTimeout(function () {
                    $(".validateTips").html('');
                    $(".validateTips").removeClass("ui-state-highlight", 1500);
                }, 5000);
            } catch (e) {
                alert(msg);
            }
        }
    </script>
</body>
</html>